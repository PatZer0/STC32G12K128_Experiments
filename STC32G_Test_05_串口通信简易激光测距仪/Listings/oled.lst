C251 COMPILER V5.60.0,  oled                                                               03/04/24  15:03:56  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE oled
OBJECT MODULE PLACED IN .\Objects\oled.obj
COMPILER INVOKED BY: C:\Keil_v5\C251\BIN\C251.EXE oled.c XSMALL INTR2 BROWSE DEBUG PRINT(.\Listings\oled.lst) TABS(2) OB
                    -JECT(.\Objects\oled.obj) 

stmt  level    source

    1          #include "oled.h"
    2          #include "font.h"
    3          #include <STDIO.H>
    4          #include <STC32G.H>
    5          #include <STRING.H>
    6          
    7          unsigned char xdata ShowBUFF[8][128];                           //OLEDå…¨å±€ç¼“å­˜
    8          
    9          //========================================================================
   10          // å‡½æ•°åç§°: delay
   11          // å‡½æ•°åŠŸèƒ½: OLEDé©±åŠ¨ç”¨çš„å»¶æ—¶
   12          // å…¥å£å‚æ•°: æ— 
   13          // å‡½æ•°è¿”å›: æ— 
   14          // å½“å‰ç‰ˆæœ¬: VER1.0
   15          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
   16          // å½“å‰ä½œè€…: ZCF
   17          // å…¶ä»–å¤‡æ³¨:
   18          //========================================================================
   19          void delay(void)
   20          {
   21   1          int xdata i;
   22   1          
   23   1          for (i=0; i<100; i++);
   24   1      }
   25          
   26          //========================================================================
   27          // å‡½æ•°åç§°: delay_ms
   28          // å‡½æ•°åŠŸèƒ½: mså»¶æ—¶å‡½æ•°
   29          // å…¥å£å‚æ•°: æ— 
   30          // å‡½æ•°è¿”å›: æ— 
   31          // å½“å‰ç‰ˆæœ¬: VER1.0
   32          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
   33          // å½“å‰ä½œè€…: ZCF
   34          // å…¶ä»–å¤‡æ³¨:
   35          //========================================================================
   36          void delay_ms(unsigned int ms)
   37          {
   38   1           unsigned int xdata i;
   39   1           do{
   40   2                i = MAIN_Fosc / 6000;
   41   2                while(--i);   //6T per loop
   42   2           }while(--ms);
   43   1      }
   44          
   45          //========================================================================
   46          // å‡½æ•°åç§°: OLED_WR_Byte
   47          // å‡½æ•°åŠŸèƒ½: OLEDåœ°å€/æ•°æ®å†™å…¥å‡½æ•°
   48          // å…¥å£å‚æ•°: @dat:æ•°æ®    @cmd:å‘½ä»¤
   49          // å‡½æ•°è¿”å›: æ— 
   50          // å½“å‰ç‰ˆæœ¬: VER1.0
   51          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
   52          // å½“å‰ä½œè€…: ZCF
   53          // å…¶ä»–å¤‡æ³¨:
   54          //========================================================================
   55          void OLED_WR_Byte(unsigned char dat,unsigned char cmd)
   56          {
   57   1          unsigned char udat[1] ;
   58   1          udat[0] = dat;
C251 COMPILER V5.60.0,  oled                                                               03/04/24  15:03:56  PAGE 2   

   59   1          if( cmd==1 )
   60   1              IIC_Write_NByte(0X78,0x40,udat,1);
   61   1          else
   62   1              IIC_Write_NByte(0X78,0x00,udat,1);
   63   1      }
   64          
   65          //========================================================================
   66          // å‡½æ•°åç§°: OLED_Init
   67          // å‡½æ•°åŠŸèƒ½: OLEDåˆå§‹åŒ–å‡½æ•°
   68          // å…¥å£å‚æ•°: æ— 
   69          // å‡½æ•°è¿”å›: æ— 
   70          // å½“å‰ç‰ˆæœ¬: VER1.0
   71          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
   72          // å½“å‰ä½œè€…: ZCF
   73          // å…¶ä»–å¤‡æ³¨:
   74          //========================================================================
   75          void OLED_Init(void)
   76          {
   77   1          IIC_Init();
   78   1          delay_ms(100);
   79   1          delay_ms(200);
   80   1      
   81   1      
   82   1          OLED_WR_Byte(0xAE,OLED_CMD);//--turn off oled panel
   83   1          OLED_WR_Byte(0x00,OLED_CMD);//---set low column address
   84   1          OLED_WR_Byte(0x10,OLED_CMD);//---set high column address
   85   1          OLED_WR_Byte(0x40,OLED_CMD);//--set start line address  Set Mapping RAM Display Start Line (0x00~0x3F
             -)
   86   1          OLED_WR_Byte(0x81,OLED_CMD);//--set contrast control register
   87   1          OLED_WR_Byte(0xCF,OLED_CMD);// Set SEG Output Current Brightness
   88   1          OLED_WR_Byte(0xA1,OLED_CMD);//--Set SEG/Column Mapping     0xa0å·¦å³åç½® 0xa1æ­£å¸¸
   89   1          OLED_WR_Byte(0xC8,OLED_CMD);//Set COM/Row Scan Direction   0xc0ä¸Šä¸‹åç½® 0xc8æ­£å¸¸
   90   1          OLED_WR_Byte(0xA6,OLED_CMD);//--set normal display
   91   1          OLED_WR_Byte(0xA8,OLED_CMD);//--set multiplex ratio(1 to 64)
   92   1          OLED_WR_Byte(0x3f,OLED_CMD);//--1/64 duty
   93   1          OLED_WR_Byte(0xD3,OLED_CMD);//-set display offset Shift Mapping RAM Counter (0x00~0x3F)
   94   1          OLED_WR_Byte(0x00,OLED_CMD);//-not offset
   95   1          OLED_WR_Byte(0xd5,OLED_CMD);//--set display clock divide ratio/oscillator frequency
   96   1          OLED_WR_Byte(0x80,OLED_CMD);//--set divide ratio, Set Clock as 100 Frames/Sec
   97   1          OLED_WR_Byte(0xD9,OLED_CMD);//--set pre-charge period
   98   1          OLED_WR_Byte(0xF1,OLED_CMD);//Set Pre-Charge as 15 Clocks & Discharge as 1 Clock
   99   1          OLED_WR_Byte(0xDA,OLED_CMD);//--set com pins hardware configuration
  100   1          OLED_WR_Byte(0x12,OLED_CMD);
  101   1          OLED_WR_Byte(0xDB,OLED_CMD);//--set vcomh
  102   1          OLED_WR_Byte(0x40,OLED_CMD);//Set VCOM Deselect Level
  103   1          OLED_WR_Byte(0x20,OLED_CMD);//-Set Page Addressing Mode (0x00/0x01/0x02)
  104   1          OLED_WR_Byte(0x02,OLED_CMD);//
  105   1          OLED_WR_Byte(0x8D,OLED_CMD);//--set Charge Pump enable/disable
  106   1          OLED_WR_Byte(0x14,OLED_CMD);//--set(0x10) disable
  107   1          OLED_WR_Byte(0xA4,OLED_CMD);// Disable Entire Display On (0xa4/0xa5)
  108   1          OLED_WR_Byte(0xA6,OLED_CMD);// Disable Inverse Display On (0xa6/a7) 
  109   1          OLED_WR_Byte(0xAF,OLED_CMD);
  110   1          OLED_BuffClear();
  111   1          OLED_BuffShow();
  112   1          OLED_DisplayOn();
  113   1      }
  114          
  115          
  116          //========================================================================
  117          // å‡½æ•°åç§°: OLED_Set_Pos
  118          // å‡½æ•°åŠŸèƒ½: OLEDè®¾ç½®æ˜¾ç¤ºä½ç½®
  119          // å…¥å£å‚æ•°: @x:xåæ ‡     @y:yåæ ‡
  120          // å‡½æ•°è¿”å›: æ— 
  121          // å½“å‰ç‰ˆæœ¬: VER1.0
  122          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
  123          // å½“å‰ä½œè€…: ZCF
C251 COMPILER V5.60.0,  oled                                                               03/04/24  15:03:56  PAGE 3   

  124          // å…¶ä»–å¤‡æ³¨:
  125          //========================================================================
  126          void OLED_Set_Pos(unsigned char x, unsigned char y) 
  127          { 
  128   1        OLED_WR_Byte((unsigned char)(0xb0+y),OLED_CMD);
  129   1        OLED_WR_Byte(((x&0xf0)>>4)|0x10,OLED_CMD);
  130   1        OLED_WR_Byte((x&0x0f),OLED_CMD); 
  131   1      }   
  132          
  133          
  134          //========================================================================
  135          // å‡½æ•°åç§°: OLED_DrawBMP
  136          // å‡½æ•°åŠŸèƒ½: OLEDæ˜¾ç¤ºå›¾ç‰‡
  137          // å…¥å£å‚æ•°: @x0:xèµ·ç‚¹  @y0:yèµ·ç‚¹    @x1:xç»ˆç‚¹   @y1:yç»ˆç‚¹  @BMPï¼šæ˜¾ç¤ºæ•°ç»„
  138          // å‡½æ•°è¿”å›: æ— 
  139          // å½“å‰ç‰ˆæœ¬: VER1.0
  140          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
  141          // å½“å‰ä½œè€…: ZCF
  142          // å…¶ä»–å¤‡æ³¨:
  143          //========================================================================
  144          void OLED_DrawBMP(unsigned char x0, unsigned char y0,unsigned char x1, unsigned char y1,unsigned char BMP
             -[])
  145          {   
  146   1          unsigned int xdata j=0;
  147   1          unsigned char xdata x,y;
  148   1      
  149   1          for(y=y0;y<(y1+y0);y++)
  150   1          {
  151   2              OLED_Set_Pos(x0,y);
  152   2              for(x=0;x<x1;x++)
  153   2              {      
  154   3                  OLED_WR_Byte(BMP[j++],OLED_DATA);       
  155   3              }
  156   2          }
  157   1      } 
  158          
  159          //========================================================================
  160          // å‡½æ•°åç§°: OLED_DisplayOn
  161          // å‡½æ•°åŠŸèƒ½: OLEDå¼€æ˜¾ç¤º
  162          // å…¥å£å‚æ•°: æ— 
  163          // å‡½æ•°è¿”å›: æ— 
  164          // å½“å‰ç‰ˆæœ¬: VER1.0
  165          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
  166          // å½“å‰ä½œè€…: ZCF
  167          // å…¶ä»–å¤‡æ³¨:
  168          //========================================================================
  169          void OLED_DisplayOn(void)     //å¼€æ˜¾ç¤º
  170          {
  171   1          OLED_WR_Byte(0x8D,OLED_CMD);//ç”µè·æ³µä½¿èƒ½
  172   1          OLED_WR_Byte(0x14,OLED_CMD);//å¼€å¯ç”µè·æ³µ
  173   1          OLED_WR_Byte(0xAF,OLED_CMD);//ç‚¹äº®å±å¹•       
  174   1      }
  175            
  176          //========================================================================
  177          // å‡½æ•°åç§°: OLED_DisplayOff
  178          // å‡½æ•°åŠŸèƒ½: OLEDå…³æ˜¾ç¤º
  179          // å…¥å£å‚æ•°: æ— 
  180          // å‡½æ•°è¿”å›: æ— 
  181          // å½“å‰ç‰ˆæœ¬: VER1.0
  182          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
  183          // å½“å‰ä½œè€…: ZCF
  184          // å…¶ä»–å¤‡æ³¨:
  185          //========================================================================
  186          void OLED_DisplayOff(void)     //å…³æ˜¾ç¤º
  187          {
  188   1          OLED_WR_Byte(0x8D,OLED_CMD);//ç”µè·æ³µä½¿èƒ½
C251 COMPILER V5.60.0,  oled                                                               03/04/24  15:03:56  PAGE 4   

  189   1          OLED_WR_Byte(0x10,OLED_CMD);//å…³é—­ç”µè·æ³µ
  190   1          OLED_WR_Byte(0xAF,OLED_CMD);//å…³é—­å±å¹•        
  191   1      }
  192          
  193          //========================================================================
  194          // å‡½æ•°åç§°: OLED_LightSet
  195          // å‡½æ•°åŠŸèƒ½: OLEDäº®åº¦è®¾ç½®
  196          // å…¥å£å‚æ•°: @numï¼š 0-255
  197          // å‡½æ•°è¿”å›: æ— 
  198          // å½“å‰ç‰ˆæœ¬: VER1.0
  199          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
  200          // å½“å‰ä½œè€…: ZCF
  201          // å…¶ä»–å¤‡æ³¨:
  202          //========================================================================
  203          void OLED_LightSet(unsigned char num)     //äº®åº¦è®¾ç½®
  204          {
  205   1          OLED_WR_Byte(0x81,OLED_CMD);//
  206   1          OLED_WR_Byte(num,OLED_CMD);//  
  207   1          OLED_WR_Byte(0xDB,OLED_CMD);//--set vcomh
  208   1          OLED_WR_Byte(0x20,OLED_CMD);//Set VCOM Deselect Level   
  209   1      }
  210          
  211          
  212          //========================================================================
  213          // å‡½æ•°åç§°: OLED_BuffClear
  214          // å‡½æ•°åŠŸèƒ½: OLEDæ¸…ç©ºç¼“å­˜
  215          // å…¥å£å‚æ•°: æ— 
  216          // å‡½æ•°è¿”å›: æ— 
  217          // å½“å‰ç‰ˆæœ¬: VER1.0
  218          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
  219          // å½“å‰ä½œè€…: ZCF
  220          // å…¶ä»–å¤‡æ³¨: å†™å…¥çš„æ˜¯ç¼“å­˜ï¼Œéœ€è¦ç”µè°ƒç”¨OLED_BuffShowæ‰èƒ½æ˜¾ç¤ºå‡ºæ¥
  221          //========================================================================
  222          void OLED_BuffClear(void)     //æ¸…å±
  223          {
  224   1          memset(ShowBUFF,0,128*8);
  225   1      }
  226          
  227          //========================================================================
  228          // å‡½æ•°åç§°: OLED_BuffShow_NoInterrupt
  229          // å‡½æ•°åŠŸèƒ½: OLEDåˆ·æ–°æ˜¾ç¤º(å…³åœä¸­æ–­)
  230          // å…¥å£å‚æ•°: æ— 
  231          // å‡½æ•°è¿”å›: æ— 
  232          // å½“å‰ç‰ˆæœ¬: VER1.0
  233          // ä¿®æ”¹æ—¥æœŸ: 2024 - 3 - 31
  234          // å½“å‰ä½œè€…: PatZer0
  235          // å…¶ä»–å¤‡æ³¨: åœ¨åˆ·æ–°å±å¹•æ—¶ï¼Œæš‚æ—¶å…³é—­ä¸­æ–­ï¼Œä»¥é¿å…ä¸­æ–­ä¸­æ–­åˆ·æ–°å±å¹•I2Cé€šä¿¡ï¼Œå
             -¯¼è‡´æ˜¾ç¤ºä¸å…¨/ä¹±ç 
  236          //========================================================================
  237          void OLED_BuffShow_NoInterrupt(void)     
  238          {
  239   1          EA = 0;
  240   1          OLED_BuffShow();
  241   1          EA = 1;
  242   1      }
  243          
  244          //========================================================================
  245          // å‡½æ•°åç§°: OLED_BuffShow
  246          // å‡½æ•°åŠŸèƒ½: OLEDåˆ·æ–°æ˜¾ç¤º
  247          // å…¥å£å‚æ•°: æ— 
  248          // å‡½æ•°è¿”å›: æ— 
  249          // å½“å‰ç‰ˆæœ¬: VER1.1
  250          // ä¿®æ”¹æ—¥æœŸ: 2024 - 3 - 28
  251          // å½“å‰ä½œè€…: ZCF, PatZer0
  252          // å…¶ä»–å¤‡æ³¨:
  253          //========================================================================
C251 COMPILER V5.60.0,  oled                                                               03/04/24  15:03:56  PAGE 5   

  254          void OLED_BuffShow(void)     
  255          {
  256   1          unsigned char xdata i,n,j;
  257   1          for(i=0;i<8;i++)
  258   1          {
  259   2              j = 0xb0 + i;             //C251æ›´åŠ ä¸¥è°¨ï¼Œè¿™æ ·å†™ä»¥é¿å…warning
  260   2              OLED_WR_Byte(j,OLED_CMD); //è®¾ç½®è¡Œèµ·å§‹åœ°å€
  261   2              OLED_WR_Byte(0x02,OLED_CMD);   //è®¾ç½®ä½åˆ—èµ·å§‹åœ°å€    // 2024.03.27ä¿®æ”¹ä½åˆ—èµ·å§‹ï¼Œå
             -¦åˆ™æµ‹è¯•ç”¨å±å¹•æ˜¾ç¤ºä¸å…¨
  262   2              OLED_WR_Byte(0x10,OLED_CMD);   //è®¾ç½®é«˜åˆ—èµ·å§‹åœ°å€
  263   2      
  264   2              for(n=0;n<128;n++)
  265   2                  OLED_WR_Byte(ShowBUFF[i][n],OLED_DATA);
  266   2          }
  267   1      }
  268          
  269          //========================================================================
  270          // å‡½æ•°åç§°: OLED_BuffShowPoint
  271          // å‡½æ•°åŠŸèƒ½: OLEDæ˜¾ç¤ºä¸€ä¸ªç‚¹
  272          // å…¥å£å‚æ•°: @xï¼šxèµ·ç‚¹   @y:yèµ·ç‚¹
  273          // å‡½æ•°è¿”å›: æ— 
  274          // å½“å‰ç‰ˆæœ¬: VER1.0
  275          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
  276          // å½“å‰ä½œè€…: ZCF
  277          // å…¶ä»–å¤‡æ³¨: å†™å…¥çš„æ˜¯ç¼“å­˜ï¼Œéœ€è¦ç”µè°ƒç”¨OLED_BuffShowæ‰èƒ½æ˜¾ç¤ºå‡ºæ¥
  278          //========================================================================
  279          void OLED_BuffShowPoint(unsigned char x,unsigned char y)     //OLEDæ˜¾ç¤ºä¸€ä¸ªç‚¹
  280          {
  281   1          ShowBUFF[y/8][x] |= 1<<(y%8);
  282   1      }
  283          
  284          //========================================================================
  285          // å‡½æ•°åç§°: OLED_BuffShowPoint
  286          // å‡½æ•°åŠŸèƒ½: OLEDæ˜¾ç¤ºä¸€æ¡çº¿
  287          // å…¥å£å‚æ•°: @x1ï¼šxèµ·ç‚¹  @y1ï¼šyèµ·ç‚¹  @x2ï¼šxç»ˆç‚¹   @y2ï¼šyç»ˆç‚¹
  288          // å‡½æ•°è¿”å›: æ— 
  289          // å½“å‰ç‰ˆæœ¬: VER1.0
  290          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
  291          // å½“å‰ä½œè€…: ZCF
  292          // å…¶ä»–å¤‡æ³¨: å†™å…¥çš„æ˜¯ç¼“å­˜ï¼Œéœ€è¦ç”µè°ƒç”¨OLED_BuffShowæ‰èƒ½æ˜¾ç¤ºå‡ºæ¥
  293          //========================================================================
  294          void OLED_BuffShowLine( unsigned char x1, unsigned char y1, unsigned char x2,unsigned char y2)
  295          {
  296   1          unsigned char x,y;
  297   1          if( x1>x2 )
  298   1          {
  299   2              x=x1;x1=x2;x2=x;
  300   2              y=y1;y1=y2;y2=y;
  301   2          }
  302   1          if(x1!=x2)
  303   1          {
  304   2              for( x = x1; x <= x2; x++ )
  305   2              {
  306   3                  if( y2>y1 )
  307   3                      OLED_BuffShowPoint(x, (unsigned char)(y1+(unsigned int)(y2-y1)*(unsigned int)x/(unsigned 
             -int)(x2-x1)));
  308   3                  else
  309   3                      OLED_BuffShowPoint(x, (unsigned char)(y1-(unsigned int)(y1-y2)*(unsigned int)x/(unsigned 
             -int)(x2-x1)));
  310   3              }        
  311   2          }
  312   1          else
  313   1          {
  314   2              if( y1>y2 )
  315   2              {
  316   3                  for( y = y2; y <= y1; y++ )
C251 COMPILER V5.60.0,  oled                                                               03/04/24  15:03:56  PAGE 6   

  317   3                     OLED_BuffShowPoint(x1, y); 
  318   3              }
  319   2              else
  320   2              {
  321   3                  for( y = y1; y <= y2; y++ )
  322   3                     OLED_BuffShowPoint(x1, y);             
  323   3              }
  324   2          }
  325   1      }
  326          
  327          //========================================================================
  328          // å‡½æ•°åç§°: OLED_BuffShowRectangle
  329          // å‡½æ•°åŠŸèƒ½: OLEDæ˜¾ç¤ºä¸€ä¸ªçŸ©å½¢
  330          // å…¥å£å‚æ•°: @x1ï¼šxèµ·ç‚¹  @y1ï¼šyèµ·ç‚¹  @x2ï¼šxç»ˆç‚¹   @y2ï¼šyç»ˆç‚¹
  331          // å‡½æ•°è¿”å›: æ— 
  332          // å½“å‰ç‰ˆæœ¬: VER1.0
  333          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
  334          // å½“å‰ä½œè€…: ZCF
  335          // å…¶ä»–å¤‡æ³¨: å†™å…¥çš„æ˜¯ç¼“å­˜ï¼Œéœ€è¦ç”µè°ƒç”¨OLED_BuffShowæ‰èƒ½æ˜¾ç¤ºå‡ºæ¥
  336          //========================================================================
  337          void OLED_BuffShowRectangle(unsigned char x1, unsigned char y1, unsigned char x2, unsigned char y2)
  338          {
  339   1          OLED_BuffShowLine(x1, y1, x2, y1);
  340   1          OLED_BuffShowLine(x1, y1, x1, y2);
  341   1          OLED_BuffShowLine(x1, y2, x2, y2);
  342   1          OLED_BuffShowLine(x2, y1, x2, y2);
  343   1      }
  344          
  345          //========================================================================
  346          // å‡½æ•°åç§°: OLED_BuffShowCircle
  347          // å‡½æ•°åŠŸèƒ½: OLEDæ˜¾ç¤ºä¸€ä¸ªåœ†å½¢
  348          // å…¥å£å‚æ•°: @xï¼šxç‚¹  @yï¼šyç‚¹  @r:åŠå¾„
  349          // å‡½æ•°è¿”å›: æ— 
  350          // å½“å‰ç‰ˆæœ¬: VER1.1
  351          // ä¿®æ”¹æ—¥æœŸ: 2024 - 3 - 28
  352          // å½“å‰ä½œè€…: ZCF, PatZer0
  353          // å…¶ä»–å¤‡æ³¨: å†™å…¥çš„æ˜¯ç¼“å­˜ï¼Œéœ€è¦ç”µè°ƒç”¨OLED_BuffShowæ‰èƒ½æ˜¾ç¤ºå‡ºæ¥
  354          //========================================================================
  355          void OLED_BuffShowCircle(unsigned char x, unsigned char y, unsigned char r)
  356          {
  357   1          int a, b;
  358   1          int di;
  359   1          unsigned char x_add_a, x_add_b, x_sub_a, x_sub_b, y_add_a, y_add_b, y_sub_a, y_sub_b;
  360   1      
  361   1          a = 0;
  362   1          b = r;
  363   1          di = 3 - (r << 1);       //åˆ¤æ–­ä¸‹ä¸ªç‚¹ä½ç½®çš„æ ‡å¿—
  364   1       
  365   1          while (a <= b)
  366   1          {
  367   2              x_add_a = x + a;
  368   2              x_add_b = x + b;
  369   2              x_sub_a = x - a;
  370   2              x_sub_b = x - b;
  371   2              y_add_a = y + a;
  372   2              y_add_b = y + b;
  373   2              y_sub_a = y - a;
  374   2              y_sub_b = y - b;
  375   2              OLED_BuffShowPoint(x_add_a, y_sub_b);        //5
  376   2              OLED_BuffShowPoint(x_add_b, y_sub_a);        //0
  377   2              OLED_BuffShowPoint(x_sub_b, y_add_a);        //4
  378   2              OLED_BuffShowPoint(x_sub_a, y_add_b);        //6
  379   2              OLED_BuffShowPoint(x_sub_a, y_sub_b);        //1
  380   2              OLED_BuffShowPoint(x_add_b, y_add_a);
  381   2              OLED_BuffShowPoint(x_sub_b, y_sub_a);        //2
  382   2              OLED_BuffShowPoint(x_add_a, y_add_b);        //7
C251 COMPILER V5.60.0,  oled                                                               03/04/24  15:03:56  PAGE 7   

  383   2              //é‡å†™ä»£ç ï¼Œé¿å…C251æŠ¥Warning
  384   2      
  385   2              a++;
  386   2       
  387   2              //ä½¿ç”¨Bresenhamç®—æ³•ç”»åœ†
  388   2              if (di < 0)di += 4 * a + 6;
  389   2              else
  390   2              {
  391   3                  di += 10 + 4 * (a - b);
  392   3                  b--;
  393   3              }
  394   2          }
  395   1      }
  396          
  397          //========================================================================
  398          // å‡½æ•°åç§°: OLED_BuffShowChar
  399          // å‡½æ•°åŠŸèƒ½: OLEDæ˜¾ç¤ºä¸€ä¸ª8*16çš„å­—ç¬¦
  400          // å…¥å£å‚æ•°: @xï¼šxç‚¹  @yï¼šyç‚¹  @asc:å­—ç¬¦   @modeï¼š0æ­£æ˜¾  1åæ˜¾
  401          // å‡½æ•°è¿”å›: æ— 
  402          // å½“å‰ç‰ˆæœ¬: VER1.0
  403          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
  404          // å½“å‰ä½œè€…: ZCF
  405          // å…¶ä»–å¤‡æ³¨: å†™å…¥çš„æ˜¯ç¼“å­˜ï¼Œéœ€è¦ç”µè°ƒç”¨OLED_BuffShowæ‰èƒ½æ˜¾ç¤ºå‡ºæ¥
  406          //========================================================================
  407          void OLED_BuffShowChar(unsigned char x,unsigned char y,char asc, unsigned char mode)     //OLEDæ˜¾ç¤ºä¸€ä
             -¸ª8*16å­—ç¬¦
  408          {
  409   1          unsigned char j,k;
  410   1          for( j=0;j<2;j++ )
  411   1          {
  412   2              for( k=0;k<8;k++ )
  413   2              {
  414   3                  if(mode==0)            
  415   3                      ShowBUFF[j+y][x+k]=Ascll_16[(asc-' ')*2][j*8+k];
  416   3                  else
  417   3                      ShowBUFF[j+y][x+k]=~Ascll_16[(asc-' ')*2][j*8+k];
  418   3              }
  419   2          }    
  420   1      }
  421          
  422          //========================================================================
  423          // å‡½æ•°åç§°: OLED_BuffShowGBK
  424          // å‡½æ•°åŠŸèƒ½: OLEDæ˜¾ç¤ºæ±‰å­—
  425          // å…¥å£å‚æ•°: @xï¼šxç‚¹  @yï¼šyç‚¹  @gbk:æ±‰å­—   @modeï¼š0æ­£æ˜¾  1åæ˜¾
  426          // å‡½æ•°è¿”å›: æ— 
  427          // å½“å‰ç‰ˆæœ¬: VER1.1
  428          // ä¿®æ”¹æ—¥æœŸ: 2024 - 3 - 29
  429          // å½“å‰ä½œè€…: ZCF, PatZer0
  430          // å…¶ä»–å¤‡æ³¨: å†™å…¥çš„æ˜¯ç¼“å­˜ï¼Œéœ€è¦ç”µè°ƒç”¨OLED_BuffShowæ‰èƒ½æ˜¾ç¤ºå‡ºæ¥
  431          //          ç”¨åˆ°çš„æ±‰å­—éœ€è¦è‡ªå·±å–æ¨¡æ”¾åˆ°å­—åº“é‡Œï¼Œå­—åº“å¤šçš„è¯ï¼Œè¿™é‡Œè¿™ä¸ªå¾ªç¯å˜é‡
             -è¦æ”¾å¤§
  432          //          å­—åº“æ–‡ä»¶font.hé‡Œæœ‰æ±‰å­—çš„GBK16æ•°ç»„ï¼Œå¯ä»¥è‡ªå·±ä¿®æ”¹
  433          //          åŸä»£ç ä½¿ç”¨å›ºå®šçš„éå†æ¬¡æ•°ï¼Œè¿™é‡Œç›´æ¥æ”¹ä¸ºGBK16æ•°ç»„å¤§å°ï¼Œç¡®ä¿æ‰€æœ‰å­—å
             -º“éƒ½è¢«éå†
  434          //========================================================================
  435          void OLED_BuffShowGBK(unsigned char x,unsigned char y,char *gbk,unsigned char mode)     //OLEDæ˜¾ç¤ºä¸€ä¸
             -ª16*16æ±‰å­—
  436          {
  437   1          unsigned char i;
  438   1          unsigned char j,k;
  439   1          for( i=0;i<sizeof(GBK16)/sizeof(GBK16[0]);i++ )
  440   1          {
  441   2              if((gbk[0] == GBK16[i].gbn_bum[0])
  442   2               &&(gbk[1] == GBK16[i].gbn_bum[1])
  443   2            )
  444   2              {
C251 COMPILER V5.60.0,  oled                                                               03/04/24  15:03:56  PAGE 8   

  445   3                  for( j=0;j<2;j++ )
  446   3                  {
  447   4                      for( k=0;k<16;k++ )
  448   4                      {
  449   5                          if( mode ==0 )
  450   5                              ShowBUFF[j+y][x+k]=GBK16[i].gbk_font[j*16+k];
  451   5                          else
  452   5                              ShowBUFF[j+y][x+k]=~GBK16[i].gbk_font[j*16+k];
  453   5                      }
  454   4                  }
  455   3                  break;
  456   3              }
  457   2          }    
  458   1      }
  459          
  460          //========================================================================
  461          // å‡½æ•°åç§°: OLED_BuffShowString
  462          // å‡½æ•°åŠŸèƒ½: OLEDæ˜¾ç¤ºå­—ç¬¦ä¸²ã€‚æ±‰å­—å­—ç¬¦å‡å¯
  463          // å…¥å£å‚æ•°: @xï¼šxç‚¹  @yï¼šyç‚¹  @så­—ç¬¦ä¸²   @modeï¼š0æ­£æ˜¾  1åæ˜¾
  464          // å‡½æ•°è¿”å›: æ— 
  465          // å½“å‰ç‰ˆæœ¬: VER1.0
  466          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
  467          // å½“å‰ä½œè€…: ZCF
  468          // å…¶ä»–å¤‡æ³¨: å†™å…¥çš„æ˜¯ç¼“å­˜ï¼Œéœ€è¦ç”µè°ƒç”¨OLED_BuffShowæ‰èƒ½æ˜¾ç¤ºå‡ºæ¥
  469          //          ç”¨åˆ°çš„æ±‰å­—éœ€è¦è‡ªå·±å–æ¨¡æ”¾åˆ°å­—åº“é‡Œï¼Œå­—åº“å¤šçš„è¯ï¼Œè¿™é‡Œè¿™ä¸ªå¾ªç¯å˜é‡
             -è¦æ”¾å¤§
  470          //========================================================================
  471          void OLED_BuffShowString(unsigned char x,unsigned char y,char *s,unsigned char mode)
  472          {
  473   1          char s_num[2];
  474   1        while(*s != '\0')       //å­—ç¬¦ä¸²ä¸ä¸ºç©ºï¼Œå¾ªç¯
  475   1        {
  476   2              if ((unsigned char)*s < 0x80)     //æ ¹æ®è¾“å…¥æ•°æ®çš„å¤§å°åˆ¤æ–­æ˜¯å­—ç¬¦è¿˜æ˜¯æ±‰å­—ï¼Œ
  477   2              {
  478   3                  OLED_BuffShowChar(x,y,*s,mode);
  479   3                  x+=8;
  480   3                  s++;
  481   3              }
  482   2              else
  483   2              {
  484   3                  s_num[0] = *s ;
  485   3                  s_num[1] = *(s+1) ;
  486   3                  OLED_BuffShowGBK(x,y,s_num,mode);
  487   3                  x+=16;
  488   3                  s+=2;
  489   3              }
  490   2          if(x>127)
  491   2              {
  492   3                  x=0;
  493   3                  y+=2;
  494   3              }
  495   2        }       
  496   1      }
  497          
  498          //========================================================================
  499          // å‡½æ•°åç§°: OLED_BuffShowNum
  500          // å‡½æ•°åŠŸèƒ½: OLEDæ˜¾ç¤ºæ•´å½¢å˜é‡
  501          // å…¥å£å‚æ•°: @xï¼šxç‚¹  @yï¼šyç‚¹  @numï¼šæ•´å½¢å˜é‡   @modeï¼š0æ­£æ˜¾  1åæ˜¾
  502          // å‡½æ•°è¿”å›: æ— 
  503          // å½“å‰ç‰ˆæœ¬: VER1.1
  504          // ä¿®æ”¹æ—¥æœŸ: 2024 - 3 - 28
  505          // å½“å‰ä½œè€…: ZCF, PatZer0
  506          // å…¶ä»–å¤‡æ³¨: å†™å…¥çš„æ˜¯ç¼“å­˜ï¼Œéœ€è¦ç”µè°ƒç”¨OLED_BuffShowæ‰èƒ½æ˜¾ç¤ºå‡ºæ¥
  507          //========================================================================
  508          void OLED_BuffShowNum(unsigned char x,unsigned char y,long num,unsigned char mode)
  509          {
C251 COMPILER V5.60.0,  oled                                                               03/04/24  15:03:56  PAGE 9   

  510   1          unsigned char xdata str[10];
  511   1          memset(str,0,10);
  512   1          sprintf(str,"%ld",num);
  513   1          OLED_BuffShowString(x,y,(unsigned char*)str, mode);
  514   1      }
  515          
  516          //========================================================================
  517          // å‡½æ•°åç§°: OLED_BuffShowNum02F
  518          // å‡½æ•°åŠŸèƒ½: OLEDæ˜¾ç¤ºä¸€ä¸ªä¸¤ä½å°æ•°å˜é‡
  519          // å…¥å£å‚æ•°: @xï¼šxç‚¹  @yï¼šyç‚¹  @numï¼šå°æ•°å˜é‡   @modeï¼š0æ­£æ˜¾  1åæ˜¾
  520          // å‡½æ•°è¿”å›: æ— 
  521          // å½“å‰ç‰ˆæœ¬: VER1.0
  522          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
  523          // å½“å‰ä½œè€…: ZCF
  524          // å…¶ä»–å¤‡æ³¨: å†™å…¥çš„æ˜¯ç¼“å­˜ï¼Œéœ€è¦ç”µè°ƒç”¨OLED_BuffShowæ‰èƒ½æ˜¾ç¤ºå‡ºæ¥
  525          //========================================================================
  526          void OLED_BuffShowNum02F(unsigned char x,unsigned char y,float num,unsigned char mode)
  527          {
  528   1          unsigned char xdata str[10];
  529   1          memset(str,0,10);
  530   1          sprintf(str,"%.2f",num);
  531   1          OLED_BuffShowString(x,y,(unsigned char*)str,mode);
  532   1      }
  533          
  534          
  535          //========================================================================
  536          // å‡½æ•°åç§°: OLED_BuffShowChar32
  537          // å‡½æ•°åŠŸèƒ½: OLEDæ˜¾ç¤º16*32çš„å­—ç¬¦
  538          // å…¥å£å‚æ•°: @xï¼šxç‚¹  @yï¼šyç‚¹  @numï¼šæ˜¾ç¤ºç¬¬å‡ ä¸ªå­—ç¬¦   @modeï¼š0æ­£æ˜¾  1åæ˜¾
  539          // å‡½æ•°è¿”å›: æ— 
  540          // å½“å‰ç‰ˆæœ¬: VER1.0
  541          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
  542          // å½“å‰ä½œè€…: ZCF
  543          // å…¶ä»–å¤‡æ³¨: å†™å…¥çš„æ˜¯ç¼“å­˜ï¼Œéœ€è¦ç”µè°ƒç”¨OLED_BuffShowæ‰èƒ½æ˜¾ç¤ºå‡ºæ¥
  544          //          ç”¨åˆ°çš„éœ€è¦è‡ªå·±å–æ¨¡å“¦
  545          //========================================================================
  546          void OLED_BuffShowChar32(unsigned char  x,unsigned char  y,unsigned char num, unsigned char mode)     
  547          {
  548   1          unsigned char j,k;
  549   1          for( j=0;j<4;j++ )
  550   1          {
  551   2              for( k=0;k<16;k++ )
  552   2              {
  553   3                  if( mode==0 )
  554   3                      ShowBUFF[j+y][x+k]=lib_num1632[num][j*16+k];
  555   3                  else
  556   3                      ShowBUFF[j+y][x+k]=~lib_num1632[num][j*16+k];
  557   3              }
  558   2          }            
  559   1      }
  560          
  561          
  562          //========================================================================
  563          // å‡½æ•°åç§°: OLED_BuffShowBMP
  564          // å‡½æ•°åŠŸèƒ½: OLEDç¼“å­˜å†™å…¥å›¾ç‰‡
  565          // å…¥å£å‚æ•°: @x0:xèµ·ç‚¹  @y0:yèµ·ç‚¹    @x1:xç»ˆç‚¹   @y1:yç»ˆç‚¹  @BMPï¼šæ˜¾ç¤ºæ•°ç»„
  566          // å‡½æ•°è¿”å›: æ— 
  567          // å½“å‰ç‰ˆæœ¬: VER1.0
  568          // ä¿®æ”¹æ—¥æœŸ: 2023 - 6 - 7
  569          // å½“å‰ä½œè€…: ZCF
  570          // å…¶ä»–å¤‡æ³¨:
  571          //========================================================================
  572          void OLED_BuffShowBMP(unsigned char x0, unsigned char y0,unsigned char x1, unsigned char y1,unsigned char
             - BMP[])
  573          {   
  574   1          unsigned int xdata num=0;
C251 COMPILER V5.60.0,  oled                                                               03/04/24  15:03:56  PAGE 10  

  575   1          unsigned char k,j;
  576   1          
  577   1          for( j=0;j<y1;j++ )
  578   1          {
  579   2              for( k=0;k<x1;k++ )
  580   2              {
  581   3                  ShowBUFF[j+y0][x0+k]=BMP[num++];
  582   3              }
  583   2          }  
  584   1      } 
  585           


Module Information          Static   Overlayable
------------------------------------------------
  code size            =      5090     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =      1024         23
  xdata-const size     =    ------     ------
  edata size           =    ------         33
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =         9     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
