C251 COMPILER V5.60.0,  lsm303                                                             06/04/24  15:09:00  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE lsm303
OBJECT MODULE PLACED IN .\Objects\lsm303.obj
COMPILER INVOKED BY: C:\Keil_v5\C251\BIN\C251.EXE Externals\lsm303.c XSMALL INTR2 BROWSE INCDIR(.\Internals;.\Externals)
                    - DEBUG PRINT(.\Listings\lsm303.lst) TABS(2) OBJECT(.\Objects\lsm303.obj) 

stmt  level    source

    1          #include "lsm303.h"
    2          
    3          void LSM303_MasterWriteOneBytetoSlave(unsigned char slave_addr, unsigned char register_addr, unsigned cha
             -r dat_to_send) 
    4          {
    5   1          // MASTER   Start   SlaveAddr+W             RegisterAddr            Data            Stop
    6   1          // SLAVE                            ACK                     ACK             ACK
    7   1          IIC_START();
    8   1          IIC_SENDBYTE(slave_addr+0);
    9   1          IIC_WAITACK();
   10   1          IIC_SENDBYTE(register_addr);
   11   1          IIC_WAITACK();
   12   1          IIC_SENDBYTE(dat_to_send);
   13   1          IIC_WAITACK();
   14   1          IIC_STOP();
   15   1      }
   16          
   17          void LSM303_MasterWriteMultipleBytestoSlave(unsigned char slave_addr, unsigned char register_addr, unsign
             -ed char *dat_to_send, unsigned char bytes_to_send)
   18          {
   19   1          // MASTER   Start   SlaveAddr+W             RegisterAddr            Data0           Data1          ..
             -.  DataN          Stop
   20   1          // SLAVE                            ACK                     ACK             ACK             ACK      
             -       ...  ACK
   21   1          unsigned char i;
   22   1      
   23   1          IIC_START();                            // å‘é€èµ·å§‹ä¿¡å·
   24   1          IIC_SENDBYTE(slave_addr);               // å‘é€ä»è®¾å¤‡åœ°å€åŠ å†™æ“ä½œä½
   25   1          IIC_WAITACK();                          // ç­‰å¾…ä»è®¾å¤‡çš„åº”ç­”
   26   1          IIC_SENDBYTE(register_addr);            // å‘é€å¯„å­˜å™¨åœ°å€
   27   1          IIC_WAITACK();                          // ç­‰å¾…ä»è®¾å¤‡çš„åº”ç­”
   28   1      
   29   1          for(i = 0; i < bytes_to_send; i++)      // å¯¹äºæ‰€æœ‰è¦å‘é€çš„æ•°æ®
   30   1          {
   31   2              IIC_SENDBYTE(dat_to_send[i]);       // å‘é€æ•°æ®
   32   2              IIC_WAITACK();                      // ç­‰å¾…ä»è®¾å¤‡çš„åº”ç­”
   33   2          }
   34   1      
   35   1          IIC_STOP();                             // å‘é€åœæ­¢ä¿¡å·
   36   1      }
   37          
   38          void LSM303_MasterRecieveOneBytefromSlave(unsigned char slave_addr, unsigned char register_addr, unsigned
             - char dat_storage) 
   39          {
   40   1          // MASTER   Start   SlaveAddr+W             RegisterAddr            StartRepeat     SlaveAddr+R      
             -               NACK    Stop
   41   1          // SLAVE                            ACK                     ACK                                     A
             -CK     Data
   42   1          IIC_START();
   43   1          IIC_SENDBYTE(slave_addr+0);
   44   1          IIC_WAITACK();
   45   1          IIC_SENDBYTE(register_addr);
   46   1          IIC_WAITACK();
   47   1          IIC_START();
   48   1          IIC_SENDBYTE(slave_addr+1);
*** WARNING C188 IN LINE 48 OF Externals\lsm303.c: 'parameter 1': value truncated
   49   1          IIC_WAITACK();
   50   1          dat_storage = IIC_READBYTE();
C251 COMPILER V5.60.0,  lsm303                                                             06/04/24  15:09:00  PAGE 2   

   51   1          IIC_SENDNACK();
   52   1          IIC_STOP();
   53   1      }
   54          
   55          void LSM303_MasterReceiveMultipleBytesfromSlave(unsigned char slave_addr, unsigned char register_addr, un
             -signed char *data_buffer, unsigned char bytes_to_receive)
   56          {
   57   1          // MASTER   Start   SlaveAddr+W             RegisterAddr            StartRepeat     SlaveAddr+R      
             -               ACK             ACK     ...     NACK    Stop
   58   1          // SLAVE                            ACK                     ACK                                     A
             -CK     Data1           DataN           ...
   59   1          unsigned char i;
   60   1      
   61   1          IIC_START();                            // å‘é€èµ·å§‹ä¿¡å·
   62   1          IIC_SENDBYTE(slave_addr);               // å‘é€ä»è®¾å¤‡åœ°å€åŠ å†™æ“ä½œä½
   63   1          IIC_WAITACK();                          // ç­‰å¾…ä»è®¾å¤‡çš„åº”ç­”
   64   1          IIC_SENDBYTE(register_addr);            // å‘é€å¯„å­˜å™¨åœ°å€
   65   1          IIC_WAITACK();                          // ç­‰å¾…ä»è®¾å¤‡çš„åº”ç­”
   66   1      
   67   1          IIC_START();                            // å‘é€é‡å¤èµ·å§‹ä¿¡å·ï¼Œåˆ‡æ¢åˆ°è¯»æ¨¡å¼
   68   1          IIC_SENDBYTE(slave_addr + 1);           // å‘é€ä»è®¾å¤‡åœ°å€åŠ è¯»æ“ä½œä½
*** WARNING C188 IN LINE 68 OF Externals\lsm303.c: 'parameter 1': value truncated
   69   1          IIC_WAITACK();                          // ç­‰å¾…ä»è®¾å¤‡çš„åº”ç­”
   70   1      
   71   1          for(i = 0; i < bytes_to_receive - 1; i++) // å¯¹äºæ‰€æœ‰è¦æ¥æ”¶çš„æ•°æ®ï¼ˆæœ€åä¸€ä¸ªå­—èŠ‚é™¤å¤
             -–ï¼‰
   72   1          {
   73   2              data_buffer[i] = IIC_READBYTE();    // è¯»å–æ•°æ®
   74   2              IIC_SENDACK();                      // å‘é€åº”ç­”ä¿¡å·ï¼Œå‡†å¤‡æ¥æ”¶ä¸‹ä¸€ä¸ªå­—èŠ‚
   75   2          }
   76   1          
   77   1          // è¯»å–æœ€åä¸€ä¸ªå­—èŠ‚å¹¶å‘é€éåº”ç­”ä¿¡å·
   78   1          data_buffer[bytes_to_receive - 1] = IIC_READBYTE(); // è¯»å–æœ€åä¸€ä¸ªå­—èŠ‚çš„æ•°æ®
   79   1          IIC_SENDNACK();                         // å¯¹äºæœ€åä¸€ä¸ªå­—èŠ‚ï¼Œå‘é€éåº”ç­”ä¿¡å·
   80   1          IIC_STOP();                             // å‘é€åœæ­¢ä¿¡å·
   81   1      }
   82          
   83          void LSM303_Init(void) 
   84          {
   85   1          LSM303_Acc_Init();
   86   1          LSM303_Mag_Init();
   87   1      }
   88          
   89          void LSM303_Acc_Init(void) 
   90          {
   91   1          // åˆå§‹åŒ–åŠ é€Ÿåº¦ä¼ æ„Ÿå™¨
   92   1          // å†™å…¥LSM303_CTRL_REG[1:6]_Aå¯„å­˜å™¨
   93   1      
   94   1          unsigned char CTRL_REG1;
   95   1          unsigned char CTRL_REG2;
   96   1          unsigned char CTRL_REG3;
   97   1          unsigned char CTRL_REG4;
   98   1          unsigned char CTRL_REG5;
   99   1          unsigned char CTRL_REG6;
  100   1      
  101   1          CTRL_REG1 = 0x57
  102   1          // é…ç½®ä¸º 0101 0111 = 0x57
  103   1          // å‰å››ä½ï¼š 0000 å…³æœºæ¨¡å¼
  104   1          //          0011 é€šç”¨1Hz    0010 é€šç”¨10Hz   0011 é€šç”¨25Hz   0100 é€šç”¨50Hz   0101 é€šç”¨100Hz
  105   1          //          0110 é€šç”¨200Hz  0111 é€šç”¨400Hz  1000 ä½åŠŸè€—1.620kHz             1001 æ™®é€š1.344kH
             -z/ä½åŠŸè€—5.376kHz
  106   1          // åå››ä½ï¼š *___ 0:ä½åŠŸè€—æ¨¡å¼å…³é—­   /   1:ä½åŠŸè€—æ¨¡å¼å¼€å¯
  107   1          //          _*__ 0:Zè½´å…³é—­          /   1:Zè½´å¼€å¯
  108   1          //          __*_ 0:Yè½´å…³é—­          /   1:Yè½´å¼€å¯
  109   1          //          ___* 0:Xè½´å…³é—­          /   1:Xè½´å¼€å¯
  110   1      
C251 COMPILER V5.60.0,  lsm303                                                             06/04/24  15:09:00  PAGE 3   

  111   1          CTRL_REG2 = 0x00; // é«˜é€šæ»¤æ³¢å™¨é…ç½®å…³é—­
*** ERROR C25 IN LINE 111 OF Externals\lsm303.c: syntax error near 'CTRL_REG2'
*** ERROR C53 IN LINE 111 OF Externals\lsm303.c: redefinition of 'CTRL_REG2'
  112   1          CTRL_REG3 = 0x00; // æ‰€æœ‰ä¸­æ–­å…³é—­
*** ERROR C53 IN LINE 112 OF Externals\lsm303.c: redefinition of 'CTRL_REG3'
  113   1          CTRL_REG4 = 0x00; // æ•°æ®è¾“å‡ºæ ¼å¼è®¾ç½®ä¸ºæ­£å¸¸æ¨¡å¼ï¼ŒÂ±2g
*** ERROR C53 IN LINE 113 OF Externals\lsm303.c: redefinition of 'CTRL_REG4'
  114   1          CTRL_REG5 = 0x00; // FIFOå…³é—­ï¼Œä¸ä½¿ç”¨é«˜é€šæ»¤æ³¢å™¨
*** ERROR C53 IN LINE 114 OF Externals\lsm303.c: redefinition of 'CTRL_REG5'
  115   1          CTRL_REG6 = 0x00; // ä¸­æ–­æ´»åŠ¨é…ç½®å…³é—­
*** ERROR C53 IN LINE 115 OF Externals\lsm303.c: redefinition of 'CTRL_REG6'
  116   1      
  117   1          // å†™å…¥å¯„å­˜å™¨
  118   1          LSM303_MasterWriteOneBytetoSlave(LSM303_ACC_ADDRESS, LSM303_CTRL_REG1_A, CTRL_REG1);
*** ERROR C25 IN LINE 118 OF Externals\lsm303.c: syntax error near '0x32'
*** ERROR C53 IN LINE 118 OF Externals\lsm303.c: redefinition of 'LSM303_MasterWriteOneBytetoSlave': different return ty
             -pes
  119   1          LSM303_MasterWriteOneBytetoSlave(LSM303_ACC_ADDRESS, LSM303_CTRL_REG2_A, CTRL_REG2);
*** ERROR C25 IN LINE 119 OF Externals\lsm303.c: syntax error near '0x32'
*** ERROR C53 IN LINE 119 OF Externals\lsm303.c: redefinition of 'LSM303_MasterWriteOneBytetoSlave': different return ty
             -pes
  120   1          LSM303_MasterWriteOneBytetoSlave(LSM303_ACC_ADDRESS, LSM303_CTRL_REG3_A, CTRL_REG3);
*** ERROR C25 IN LINE 120 OF Externals\lsm303.c: syntax error near '0x32'
*** ERROR C53 IN LINE 120 OF Externals\lsm303.c: redefinition of 'LSM303_MasterWriteOneBytetoSlave': different return ty
             -pes
  121   1          LSM303_MasterWriteOneBytetoSlave(LSM303_ACC_ADDRESS, LSM303_CTRL_REG4_A, CTRL_REG4);
*** ERROR C25 IN LINE 121 OF Externals\lsm303.c: syntax error near '0x32'
*** ERROR C53 IN LINE 121 OF Externals\lsm303.c: redefinition of 'LSM303_MasterWriteOneBytetoSlave': different return ty
             -pes
  122   1          LSM303_MasterWriteOneBytetoSlave(LSM303_ACC_ADDRESS, LSM303_CTRL_REG5_A, CTRL_REG5);
*** ERROR C25 IN LINE 122 OF Externals\lsm303.c: syntax error near '0x32'
*** ERROR C53 IN LINE 122 OF Externals\lsm303.c: redefinition of 'LSM303_MasterWriteOneBytetoSlave': different return ty
             -pes
  123   1          LSM303_MasterWriteOneBytetoSlave(LSM303_ACC_ADDRESS, LSM303_CTRL_REG6_A, CTRL_REG6);
*** ERROR C25 IN LINE 123 OF Externals\lsm303.c: syntax error near '0x32'
*** ERROR C53 IN LINE 123 OF Externals\lsm303.c: redefinition of 'LSM303_MasterWriteOneBytetoSlave': different return ty
             -pes
  124   1      }
*** ERROR C25 IN LINE 124 OF Externals\lsm303.c: syntax error near '}'
  125   1      
  126   1      void LSM303_Mag_Init(void) {
  127   2          // åˆå§‹åŒ–ç£åœºä¼ æ„Ÿå™¨
  128   2          unsigned char data;
*** ERROR C25 IN LINE 128 OF Externals\lsm303.c: syntax error near ';'
  129   2      
  130   2          // é…ç½®CRA_REG_Mï¼Œæ•°æ®è¾“å‡ºé€Ÿç‡ä¸º15Hz
  131   2          data = 0x10; // 0001 0000
*** ERROR C25 IN LINE 131 OF Externals\lsm303.c: syntax error near '='
  132   2          LSM303_MasterWriteOneBytetoSlave(LSM303_MAG_ADDRESS, LSM303_CRA_REG_M, data);
*** ERROR C25 IN LINE 132 OF Externals\lsm303.c: syntax error near '0x3C'
*** ERROR C7 IN LINE 132 OF Externals\lsm303.c: compilation aborted

C251 COMPILATION COMPLETE.  2 WARNING(S),  23 ERROR(S)
