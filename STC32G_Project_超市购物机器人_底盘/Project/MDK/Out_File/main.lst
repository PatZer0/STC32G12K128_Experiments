C251 COMPILER V5.60.0,  main                                                               08/04/24  20:20:26  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE main
OBJECT MODULE PLACED IN .\Out_File\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C251\BIN\C251.EXE ..\USER\src\main.c XSMALL INTR2 WARNINGLEVEL(3) OPTIMIZE(0,SPEED) BROW
                    -SE INCDIR(..\..\Libraries\libraries;..\..\Libraries\seekfree_libraries;..\..\Libraries\seekfree_peripheral;..\CODE;..\US
                    -ER\inc;..\USER\src;..\..\Libraries\seekfree_components) DEBUG PRINT(.\Out_File\main.lst) TABS(2) OBJECT(.\Out_File\main.
                    -obj) 

stmt  level    source

    1          #include "headfile.h"
    2          /*
    3           * 系统频率，可查看board.h中的 FOSC 宏定义修改。
    4           * board.h文件中FOSC的值设置为0,则程序自动设置系统频率为33.1776MHZ
    5           * 在board_init中,已经将P54引脚设置为复位
    6           * 如果需要使用P54引脚,可以在board.c文件中的board_init()函数中删除SET_P54_RESRT即可
    7           */
    8          
    9          #include "motor_driver_boards.h"     // 电机驱动板头文件
   10          /* -----------------------------------电机驱动板连接----------------------------------------
   11           * 电机驱动板1（X方向轮）接线：
   12           * PA <--> P60     PB <--> P62
   13           * A1 <--> P40     A2 <--> P41
   14           * B1 <--> P43     B2 <--> P42
   15          
   16           * 电机驱动板2（Y方向轮）接线：
   17           * PA <--> P64     PB <--> P66
   18           * A1 <--> P44     A2 <--> P45
   19           * B1 <--> P47     B2 <--> P46
   20          */
   21          
   22          /* -----------------------------------SPI-OLED显示屏----------------------------------------
   23           *  - 连接屏幕默认使用端口为：
   24           *    D0 - P2.5(SCLK)
   25           *    D1 - P2.3(MOSI)
   26           *    CS - P2.2(CS)
   27           *    DC - P2.1(DC)
   28           *    RES - P2.0(RES)
   29          */
   30          
   31          #include "lsm303_sw.h"
   32          /* -----------------------------------LSM303传感器------------------------------------------
   33           *  - 连接传感器默认使用端口为：
   34           *    SCL - P32(SCL)
   35           *    SDA - P33(SDA)
   36          */
   37          void gpio_init()
   38          {
   39   1          gpio_mode(P4, GPO_PP);
   40   1          gpio_mode(P6, GPO_PP);
   41   1      }
   42          
   43          void motor_drivers_pwm_init()
   44          {
   45   1          pwm_init(PWMA_CH1P_P60, 30000, 1000);
   46   1          pwm_init(PWMA_CH2P_P62, 30000, 1000);
   47   1          pwm_init(PWMA_CH3P_P64, 30000, 1000);
   48   1          pwm_init(PWMA_CH4P_P66, 30000, 1000);
   49   1      }
   50          
   51          void lsm303_iic_init(void)
   52          {
   53   1          iic_init(IIC_4, IIC4_SCL_P32, IIC4_SDA_P33, 19);
   54   1          // 需要注意SEEKFREE LIBRARY默认提供的项目文件没有导入iic相关c文件
   55   1          // 需要手动在Keil中添加
   56   1      }
C251 COMPILER V5.60.0,  main                                                               08/04/24  20:20:26  PAGE 2   

   57          
   58          void main()
   59          {   
   60   1          float acc_x, acc_y, acc_z;
   61   1          float mag_x, mag_y, mag_z;
   62   1        board_init();             // 初始化寄存器,勿删除此句代码。
   63   1          gpio_init();                    // 初始化GPIO，使得P4和P6正确输出
   64   1          oled_init_spi();                // 初始化OLED显示屏
   65   1          // lsm303_iic_init();              // 初始化LSM303_IIC接口
   66   1          lsm303_init_all();              // 初始化LSM303传感器
   67   1          motor_drivers_pwm_init();     // 初始化PWM
   68   1          while(1)
   69   1          {
   70   2              oled_p6x8str_spi(0, 0, "LSM303 DATA READ TEST");
   71   2              oled_p6x8str_spi(0, 1, "ACC X:");
   72   2              oled_p6x8str_spi(0, 2, "ACC Y:");
   73   2              oled_p6x8str_spi(0, 3, "ACC Z:");
   74   2              acc_x = lsm303_read_acc('x');
   75   2              acc_y = lsm303_read_acc('y');
   76   2              acc_z = lsm303_read_acc('z');
   77   2              oled_printf_float_spi(6*7, 1, acc_x, 4, 6);
   78   2              oled_printf_float_spi(6*7, 2, acc_y, 4, 6);
   79   2              oled_printf_float_spi(6*7, 3, acc_z, 4, 6);
   80   2              mag_x = lsm303_read_mag('x');
   81   2              mag_y = lsm303_read_mag('y');
   82   2              mag_z = lsm303_read_mag('z');
   83   2              oled_p6x8str_spi(0, 5, "MAG X:");
   84   2              oled_p6x8str_spi(0, 6, "MAG Y:");
   85   2              oled_p6x8str_spi(0, 7, "MAG Z:");
   86   2              oled_printf_float_spi(6*7, 5, mag_x, 4, 6);
   87   2              oled_printf_float_spi(6*7, 6, mag_y, 4, 6);
   88   2              oled_printf_float_spi(6*7, 7, mag_z, 4, 6);
   89   2              delay_ms(100);
   90   2              // wheels_x_forward();
   91   2              // wheels_y_forward();
   92   2              // delay_ms(255);
   93   2              // pwm_duty(PWMA_CH1P_P60, 2000);
   94   2              // pwm_duty(PWMA_CH2P_P62, 2000);
   95   2              // pwm_duty(PWMA_CH3P_P64, 2000);
   96   2              // pwm_duty(PWMA_CH4P_P66, 2000);
   97   2              // delay_ms(255);
   98   2              // wheels_x_backward();
   99   2              // wheels_y_backward();
  100   2              // delay_ms(255);
  101   2              // pwm_duty(PWMA_CH1P_P60, 5000);
  102   2              // pwm_duty(PWMA_CH2P_P62, 5000);
  103   2              // pwm_duty(PWMA_CH3P_P64, 5000);
  104   2              // pwm_duty(PWMA_CH4P_P66, 5000);
  105   2              // delay_ms(255);
  106   2              // wheels_all_stop();
  107   2              // delay_ms(255);
  108   2          }
  109   1      }
  110          
  111          
  112          /********************************************************************************************************
             -*************
  113           * COPYRIGHT NOTICE
  114           * Copyright (c) 2020,逐飞科技
  115           * All rights reserved.
  116           * 技术讨论QQ群：一群：179029047(已满)  二群：244861897(已满)  三群：824575535
  117           *
  118           * 以下所有内容版权均属逐飞科技所有，未经允许不得用于商业用途，
  119           * 欢迎各位使用并传播本程序，修改内容时必须保留逐飞科技的版权声明。
  120           *
  121           * @file          main
C251 COMPILER V5.60.0,  main                                                               08/04/24  20:20:26  PAGE 3   

  122           * @company       成都逐飞科技有限公司
  123           * @author        逐飞科技(QQ790875685)
  124           * @version       查看doc内version文件 版本说明
  125           * @Software    MDK FOR C251 V5.60
  126           * @Target core   STC32G12K128
  127           * @Taobao      https://seekfree.taobao.com/
  128           * @date          2020-12-18
  129           ********************************************************************************************************
             -************/


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       446     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =        24     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =        64     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
