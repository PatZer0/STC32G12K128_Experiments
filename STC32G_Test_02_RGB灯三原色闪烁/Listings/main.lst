C251 COMPILER V5.60.0,  main                                                               26/03/24  18:22:30  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE main
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C251\BIN\C251.EXE main.c XSMALL INTR2 BROWSE DEBUG PRINT(.\Listings\main.lst) TABS(2) OB
                    -JECT(.\Objects\main.obj) 

stmt  level    source

    1          #include <STC32G.h>
    2          // #define MAIN_Fosc 24000000UL    // ä¸»é¢‘ï¼Œæœ¬å®ä¾‹ä¸­ä¸éœ€è¦
    3          
    4          // å®šä¹‰æŒ‰é”®å¼•è„š
    5          sbit key1 = P2^0;
    6          sbit key2 = P2^1;
    7          sbit key3 = P2^2;
    8          sbit key4 = P2^3;
    9          // å®šä¹‰LEDå¼•è„š
   10          sbit led_vcc_green = P5^0;
   11          sbit led_vcc_red = P5^1;
   12          sbit led_vcc_blue = P5^2;
   13          
   14          unsigned char led_power = 0; // LED ç”µæºçŠ¶æ€ï¼Œ0ä¸ºå…³é—­ï¼Œ1ä¸ºå¼€å¯
   15          
   16          unsigned int led_rgb_flash_interval = 750; // LED ä¸‰åŸè‰²å¾ªç¯åˆ‡æ¢é—´éš”ï¼Œå•ä½ä¸ºæ¯«ç§’
   17          unsigned int led_rgb_flash_interval_index = 0; // LED ä¸‰åŸè‰²å¾ªç¯åˆ‡æ¢é—´éš”ç´¢å¼•ï¼Œç”¨äºé€‰æ‹©æ•°
             -ç»„ä¸­çš„æŸä¸ªå€¼
   18          unsigned int led_rgb_flash_intervals[6] = {100, 200, 500, 750, 1000, 2000}; // LED ä¸‰åŸè‰²å¾ªç¯åˆ‡æ¢é
             -—´éš”ï¼Œå•ä½ä¸ºæ¯«ç§’
   19          unsigned char led_rgb_flash_array[3][3] = {{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}; // LED ä¸‰åŸè‰²å¾ªç¯åˆ‡æ¢
             -æ•°ç»„ï¼Œ0ä¸ºå…³é—­ï¼Œ1ä¸ºå¼€å¯
   20          unsigned char led_rgb_flash_index = 0; // LED ä¸‰åŸè‰²å¾ªç¯åˆ‡æ¢ä¸»ç´¢å¼•ï¼Œç”¨äºé€‰æ‹©æ•°ç»„ä¸­çš„æŸ
             -ä¸ªå€¼
   21          
   22          unsigned int led_color_gradient_interval = 1000; // LED å½©è‰²æ¸å˜å‘¨æœŸé•¿åº¦ï¼Œå•ä½ä¸ºæ¯«ç§’
   23          unsigned int led_color_gradient_interval_index = 0; // LED å½©è‰²æ¸å˜å‘¨æœŸé•¿åº¦ç´¢å¼•ï¼Œç”¨äºé€‰æ‹©æ
             -•°ç»„ä¸­çš„æŸä¸ªå€¼
   24          unsigned int led_color_gradient_intervals[7] = {100, 200, 500, 750, 1000, 2000, 3000}; // LED å½©è‰²æ¸å
             -˜å‘¨æœŸé•¿åº¦ï¼Œå•ä½ä¸ºæ¯«ç§’
   25          
   26          unsigned char key1_up_store = 1; // æŒ‰é”®1çŠ¶æ€æš‚å­˜
   27          unsigned char key2_up_store = 1; // æŒ‰é”®2çŠ¶æ€æš‚å­˜
   28          unsigned char key3_up_store = 1; // æŒ‰é”®3çŠ¶æ€æš‚å­˜
   29          unsigned char key4_up_store = 1; // æŒ‰é”®4çŠ¶æ€æš‚å­˜
   30          
   31          unsigned char led_rgb_mode = 0; // RGB LEDç¯å…‰æ¨¡å¼ï¼Œ0ä¸ºç™½å…‰å¸¸äº®ï¼Œ1ä¸ºä¸‰åŸè‰²å¾ªç¯ï¼Œ2ä¸ºå½©
             -è‰²æ¸å˜å¾ªç¯
   32          
   33          // è®¡æ•°å™¨è¦ä½¿ç”¨intç±»å‹ï¼Œå¦‚æœä½¿ç”¨char(æœ€å¤§å€¼255)ä¼šæº¢å‡ºï¼Œå¯¼è‡´åŠŸèƒ½å¼‚å¸¸
   34          unsigned int timer0_counter = 0; // LEDæµæ°´è®¡æ•°å™¨
   35          
   36          void key1_short_press()
   37          {
   38   1          // çŸ­æŒ‰é”®1åŠŸèƒ½ï¼šå…³é—­RGBç¯
   39   1          led_power = 0;
   40   1      }
   41          
   42          void key2_short_press()
   43          {
   44   1          // çŸ­æŒ‰é”®2åŠŸèƒ½ï¼šæ‰“å¼€RGBç¯
   45   1          led_power = 1;
   46   1      }
   47          
   48          void key3_short_press()
   49          {
   50   1          // çŸ­æŒ‰é”®3åŠŸèƒ½ï¼šåˆ‡æ¢LEDç¯æ¨¡å¼ã€ç™½å…‰å¸¸äº®/ä¸‰è‰²å¾ªç¯ã€‘
   51   1          led_rgb_mode++;
C251 COMPILER V5.60.0,  main                                                               26/03/24  18:22:30  PAGE 2   

   52   1          if(led_rgb_mode > 1)
   53   1          {
   54   2              led_rgb_mode = 0;
   55   2          }
   56   1      }
   57          
   58          void key4_short_press()
   59          {
   60   1          // çŸ­æŒ‰é”®4åŠŸèƒ½ï¼šæ›´æ”¹LEDå˜åŒ–çš„é€Ÿåº¦
   61   1          if(led_rgb_mode == 1)
   62   1          {
   63   2              led_rgb_flash_interval_index++;
   64   2              led_rgb_flash_interval = led_rgb_flash_intervals[led_rgb_flash_interval_index % 6];
   65   2              if(led_rgb_flash_interval_index >= 6)
   66   2              {
   67   3                  led_rgb_flash_interval_index = 0;
   68   3              }
   69   2          }
   70   1          else if(led_rgb_mode == 2)
   71   1          {
   72   2              led_color_gradient_interval_index++;
   73   2              led_color_gradient_interval = led_color_gradient_intervals[led_color_gradient_interval_index % 7]
             -;
   74   2              if(led_color_gradient_interval_index >= 7)
   75   2              {
   76   3                  led_color_gradient_interval_index = 0;
   77   3              }
   78   2          }
   79   1      }
   80          
   81          void key1_check() 
   82          {
   83   1          if(key1 == 0 && key1_up_store == 1)
   84   1          {
   85   2              key1_up_store = 0; // æ ‡è®°æŒ‰é”®è¢«æŒ‰ä¸‹
   86   2          }
   87   1          if(key1 == 1 && key1_up_store == 0)
   88   1          {
   89   2              key1_up_store = 1; // æ ‡è®°æŒ‰é”®è¢«é‡Šæ”¾
   90   2              key1_short_press(); // è§¦å‘çŸ­æŒ‰é”®1åŠŸèƒ½
   91   2          }
   92   1      }
   93          
   94          void key2_check()
   95          {
   96   1          if(key2 == 0 && key2_up_store == 1)
   97   1          {
   98   2              key2_up_store = 0; // æ ‡è®°æŒ‰é”®è¢«æŒ‰ä¸‹
   99   2          }
  100   1          if(key2 == 1 && key2_up_store == 0)
  101   1          {
  102   2              key2_up_store = 1; // æ ‡è®°æŒ‰é”®è¢«é‡Šæ”¾
  103   2              key2_short_press(); // è§¦å‘çŸ­æŒ‰é”®2åŠŸèƒ½
  104   2          }
  105   1      }
  106          
  107          void key3_check()
  108          {
  109   1          if(key3 == 0 && key3_up_store == 1)
  110   1          {
  111   2              key3_up_store = 0; // æ ‡è®°æŒ‰é”®è¢«æŒ‰ä¸‹
  112   2          }
  113   1          if(key3 == 1 && key3_up_store == 0)
  114   1          {
  115   2              key3_up_store = 1; // æ ‡è®°æŒ‰é”®è¢«é‡Šæ”¾
  116   2              key3_short_press(); // è§¦å‘çŸ­æŒ‰é”®3åŠŸèƒ½
C251 COMPILER V5.60.0,  main                                                               26/03/24  18:22:30  PAGE 3   

  117   2          }
  118   1      }
  119          
  120          void key4_check()
  121          {
  122   1          if(key4 == 0 && key4_up_store == 1)
  123   1          {
  124   2              key4_up_store = 0; // æ ‡è®°æŒ‰é”®è¢«æŒ‰ä¸‹
  125   2          }
  126   1          if(key4 == 1 && key4_up_store == 0)
  127   1          {
  128   2              key4_up_store = 1; // æ ‡è®°æŒ‰é”®è¢«é‡Šæ”¾
  129   2              key4_short_press(); // è§¦å‘çŸ­æŒ‰é”®4åŠŸèƒ½
  130   2          }
  131   1      }
  132          
  133          void led_disabled()
  134          {
  135   1          led_vcc_green = 0;
  136   1          led_vcc_red = 0;
  137   1          led_vcc_blue = 0;
  138   1      }
  139          
  140          void led_mode_0_white_light()
  141          {
  142   1          led_vcc_green = 1;
  143   1          led_vcc_red = 1;
  144   1          led_vcc_blue = 1;
  145   1      }
  146          
  147          void led_mode_1_rgb_flash()
  148          {
  149   1          led_rgb_flash_index++;
  150   1          if(led_rgb_flash_index >= 3)
  151   1          {
  152   2              led_rgb_flash_index = 0;
  153   2          }
  154   1          led_vcc_green = led_rgb_flash_array[led_rgb_flash_index][0];
  155   1          led_vcc_red = led_rgb_flash_array[led_rgb_flash_index][1];
  156   1          led_vcc_blue = led_rgb_flash_array[led_rgb_flash_index][2];
  157   1      }
  158          
  159          void timer0_isr(void) interrupt 1
  160          {
  161   1          timer0_counter++;
  162   1          if(led_power == 0)
  163   1          {
  164   2              led_disabled();
  165   2          }
  166   1          // RGB LEDç¯å…‰æ¨¡å¼ï¼Œ0ä¸ºç™½å…‰å¸¸äº®
  167   1          else if(led_rgb_mode == 0 && led_power == 1)
  168   1          {
  169   2              led_mode_0_white_light();
  170   2          }
  171   1          // 1ä¸ºä¸‰åŸè‰²å¾ªç¯
  172   1          else if(led_rgb_mode == 1 && led_power == 1)
  173   1          {
  174   2              if(timer0_counter >= led_rgb_flash_interval)
  175   2              {
  176   3                  timer0_counter = 0;
  177   3                  led_mode_1_rgb_flash();
  178   3              }
  179   2          }
  180   1      }
  181          
  182          void timer0_init(void)    //0.1æ¯«ç§’@24.000M å¯¹åº” PWMé¢‘ç‡5000Hz
C251 COMPILER V5.60.0,  main                                                               26/03/24  18:22:30  PAGE 4   

  183          {
  184   1        AUXR |= 0x80;     //å®šæ—¶å™¨æ—¶é’Ÿ1Tæ¨¡å¼
  185   1        TMOD &= 0xF0;     //è®¾ç½®å®šæ—¶å™¨æ¨¡å¼
  186   1        TL0 = 0xA0;       //è®¾ç½®å®šæ—¶åˆå§‹å€¼
  187   1        TH0 = 0xF6;       //è®¾ç½®å®šæ—¶åˆå§‹å€¼
  188   1        TF0 = 0;        //æ¸…é™¤TF0æ ‡å¿—
  189   1        TR0 = 1;        //å®šæ—¶å™¨0å¼€
  190   1        ET0 = 1;        //ä½¿èƒ½å®šæ—¶å™¨0ä¸­æ–­
  191   1          EA = 1;           //ä½¿èƒ½æ€»ä¸­æ–­
  192   1      }
  193          
  194          // å»¶æ—¶å‡½æ•°ï¼Œæœ¬å®ä¾‹ä¸­æœªä½¿ç”¨
  195          // void delay_ms(unsigned char ms)
  196          // {
  197          //      unsigned int i;
  198          //      do{
  199          //           i = MAIN_Fosc / 6000;
  200          //           while(--i);
  201          //      }while(--ms);
  202          // }
  203          
  204          void main(void)
  205          {
  206   1          WTST = 0;  //è®¾ç½®ç¨‹åºæŒ‡ä»¤å»¶æ—¶å‚æ•°ï¼Œèµ‹å€¼ä¸º0å¯å°†CPUæ‰§è¡ŒæŒ‡ä»¤çš„é€Ÿåº¦è®¾ç½®ä¸ºæœ€å¿«
  207   1          EAXFR = 1; //æ‰©å±•å¯„å­˜å™¨(XFR)è®¿é—®ä½¿èƒ½
  208   1          CKCON = 0; //æé«˜è®¿é—®XRAMé€Ÿåº¦
  209   1      
  210   1          P5M0 = 0xff; P5M1 = 0x00;           //é…ç½®P5ä¸ºè¾“å‡ºæ¨¡å¼
  211   1          P2M0 = 0x00; P2M1 = 0x00;           //é…ç½®P2ä¸ºå‡†åŒå‘æ¨¡å¼
  212   1      
  213   1          timer0_init();                      //åˆå§‹åŒ–å®šæ—¶å™¨0
  214   1          while(1)
  215   1          {
  216   2              // æ£€æµ‹æŒ‰é”®
  217   2              key1_check();
  218   2              key2_check();
  219   2              key3_check();
  220   2              key4_check();
  221   2          }
  222   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       520     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =        52     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =       112     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
