C251 COMPILER V5.60.0,  main                                                               26/03/24  10:39:46  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE main
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C251\BIN\C251.EXE main.c XSMALL INTR2 BROWSE DEBUG PRINT(.\Listings\main.lst) TABS(2) OB
                    -JECT(.\Objects\main.obj) 

stmt  level    source

    1          #include <STC32G.h>
    2          #define LED_GND P4  // è¿æ¥åˆ°GNDçš„LED
    3          // #define MAIN_Fosc 24000000UL    // ä¸»é¢‘
    4          
    5          // å®šä¹‰æŒ‰é”®å¼•è„š
    6          sbit key1 = P2^0;
    7          sbit key2 = P2^1;
    8          sbit key3 = P2^2;
    9          sbit key4 = P2^3;
   10          
   11          // è®¡æ•°å™¨è¦ä½¿ç”¨intç±»å‹ï¼Œå¦‚æœä½¿ç”¨char(æœ€å¤§å€¼255)ä¼šæº¢å‡ºï¼Œå¯¼è‡´åŠŸèƒ½å¼‚å¸¸
   12          unsigned int led_interval_flash = 500; // LEDé—ªçƒé€Ÿåº¦ï¼Œé»˜è®¤500msåˆ‡æ¢ä¸€æ¬¡
   13          unsigned int led_interval_light_up_in_turn = 1000; // LEDä¾æ¬¡ç‚¹äº®é—´éš”ï¼Œé»˜è®¤1000msåˆ‡æ¢ä¸€æ¬¡
   14          unsigned char led_flash_index = 0; // LEDæµæ°´èµ·å§‹ä½ç½®
   15          unsigned char led_flash_mode = 0; // LEDæµæ°´æ¨¡å¼ï¼Œ0ä¸ºé™æ€å…¨éƒ¨ç†„ç­ï¼Œ1ä¸ºé™æ€å…¨éƒ¨äº®ï¼Œ2ä¸
             -ºä¾æ¬¡ç‚¹äº®ï¼Œ3ä¸ºæµæ°´ç¯
   16          unsigned char led_flash_array[8] = {0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80};  // LEDæµæ°´æ•°ç»„
   17          unsigned char led_light_up_in_turn[8] = {0x01, 0x03, 0x07, 0x0f, 0x1f, 0x3f, 0x7f, 0xff}; // LEDä¾æ¬¡ç‚¹
             -äº®æ•°ç»„
   18          unsigned int timer0_counter = 0; // LEDæµæ°´è®¡æ•°å™¨
   19          
   20          unsigned char key1_up_store = 1; // æŒ‰é”®1çŠ¶æ€æš‚å­˜
   21          unsigned char key2_up_store = 1; // æŒ‰é”®2çŠ¶æ€æš‚å­˜
   22          unsigned char key3_up_store = 1; // æŒ‰é”®3çŠ¶æ€æš‚å­˜
   23          unsigned char key4_up_store = 1; // æŒ‰é”®4çŠ¶æ€æš‚å­˜
   24          
   25          void key1_short_press()
   26          {
   27   1          // çŸ­æŒ‰é”®1åŠŸèƒ½
   28   1          // ç‚¹äº®æ‰€æœ‰LED
   29   1          led_flash_mode = 1;
   30   1      }
   31          
   32          void key2_short_press()
   33          {
   34   1          // çŸ­æŒ‰é”®2åŠŸèƒ½
   35   1          // ç†„ç­æ‰€æœ‰LED
   36   1          led_flash_mode = 0;
   37   1      }
   38          
   39          void key3_short_press()
   40          {
   41   1          // çŸ­æŒ‰é”®3åŠŸèƒ½
   42   1          // LEDé—´éš”ä¸€ç§’ä¾æ¬¡ç‚¹äº®
   43   1          led_flash_mode = 2;
   44   1      }
   45          
   46          void key4_short_press()
   47          {
   48   1          // çŸ­æŒ‰é”®4åŠŸèƒ½
   49   1          // LEDæµæ°´ç¯0.5ç§’
   50   1          led_flash_mode = 3;
   51   1      }
   52          
   53          void key1_check() 
   54          {
   55   1          if(key1 == 0 && key1_up_store == 1)
   56   1          {
C251 COMPILER V5.60.0,  main                                                               26/03/24  10:39:46  PAGE 2   

   57   2              key1_up_store = 0; // æ ‡è®°æŒ‰é”®è¢«æŒ‰ä¸‹
   58   2          }
   59   1          if(key1 == 1 && key1_up_store == 0)
   60   1          {
   61   2              key1_up_store = 1; // æ ‡è®°æŒ‰é”®è¢«é‡Šæ”¾
   62   2              key1_short_press(); // è§¦å‘çŸ­æŒ‰é”®1åŠŸèƒ½
   63   2          }
   64   1      }
   65          
   66          void key2_check()
   67          {
   68   1          if(key2 == 0 && key2_up_store == 1)
   69   1          {
   70   2              key2_up_store = 0; // æ ‡è®°æŒ‰é”®è¢«æŒ‰ä¸‹
   71   2          }
   72   1          if(key2 == 1 && key2_up_store == 0)
   73   1          {
   74   2              key2_up_store = 1; // æ ‡è®°æŒ‰é”®è¢«é‡Šæ”¾
   75   2              key2_short_press(); // è§¦å‘çŸ­æŒ‰é”®2åŠŸèƒ½
   76   2          }
   77   1      }
   78          
   79          void key3_check()
   80          {
   81   1          if(key3 == 0 && key3_up_store == 1)
   82   1          {
   83   2              key3_up_store = 0; // æ ‡è®°æŒ‰é”®è¢«æŒ‰ä¸‹
   84   2          }
   85   1          if(key3 == 1 && key3_up_store == 0)
   86   1          {
   87   2              key3_up_store = 1; // æ ‡è®°æŒ‰é”®è¢«é‡Šæ”¾
   88   2              key3_short_press(); // è§¦å‘çŸ­æŒ‰é”®3åŠŸèƒ½
   89   2          }
   90   1      }
   91          
   92          void key4_check()
   93          {
   94   1          if(key4 == 0 && key4_up_store == 1)
   95   1          {
   96   2              key4_up_store = 0; // æ ‡è®°æŒ‰é”®è¢«æŒ‰ä¸‹
   97   2          }
   98   1          if(key4 == 1 && key4_up_store == 0)
   99   1          {
  100   2              key4_up_store = 1; // æ ‡è®°æŒ‰é”®è¢«é‡Šæ”¾
  101   2              key4_short_press(); // è§¦å‘çŸ­æŒ‰é”®4åŠŸèƒ½
  102   2          }
  103   1      }
  104          
  105          void led_flash()
  106          {
  107   1          // 0ä¸ºé™æ€å…¨éƒ¨ç†„ç­ï¼Œ1ä¸ºé™æ€å…¨éƒ¨äº®ï¼Œ2ä¸ºä¾æ¬¡ç‚¹äº®ï¼Œ3ä¸ºæµæ°´ç¯
  108   1          if(led_flash_mode == 0)
  109   1          {
  110   2              LED_GND = 0xFF; // å…¨éƒ¨ç†„ç­
  111   2          }
  112   1          else if(led_flash_mode == 1)
  113   1          {
  114   2              LED_GND = 0x00; // å…¨éƒ¨ç†„ç­
  115   2          }
  116   1          else if(led_flash_mode == 2)
  117   1          {
  118   2              LED_GND = ~led_light_up_in_turn[led_flash_index]; // ä¾æ¬¡ç‚¹äº®
  119   2              led_flash_index++;
  120   2              if(led_flash_index >= 8)
  121   2              {
  122   3                  led_flash_index = 0;
C251 COMPILER V5.60.0,  main                                                               26/03/24  10:39:46  PAGE 3   

  123   3              }
  124   2          }
  125   1          else if(led_flash_mode == 3)
  126   1          {
  127   2              LED_GND = ~led_flash_array[led_flash_index]; // æµæ°´ç¯
  128   2              led_flash_index++;
  129   2              if(led_flash_index >= 8)
  130   2              {
  131   3                  led_flash_index = 0;
  132   3              }
  133   2          }
  134   1      }
  135          
  136          void timer0_isr(void) interrupt 1
  137          {
  138   1          timer0_counter++;
  139   1          if (led_flash_mode == 0 || led_flash_mode == 1)
  140   1          {
  141   2              timer0_counter = 0;
  142   2              led_flash();
  143   2          }
  144   1          else if(led_flash_mode == 3 && timer0_counter >= led_interval_flash)
  145   1          {
  146   2              timer0_counter = 0;
  147   2              led_flash();
  148   2          }
  149   1          else if(led_flash_mode == 2 && timer0_counter >= led_interval_light_up_in_turn)
  150   1          {
  151   2              timer0_counter = 0;
  152   2              led_flash();
  153   2          }
  154   1      }
  155          
  156          void timer0_init(void)    //1æ¯«ç§’@24.000M
  157          {
  158   1        AUXR |= 0x80;     //å®šæ—¶å™¨æ—¶é’Ÿ1Tæ¨¡å¼
  159   1        TMOD &= 0xF0;     //è®¾ç½®å®šæ—¶å™¨æ¨¡å¼
  160   1        TL0 = 0x40;       //è®¾ç½®å®šæ—¶åˆå§‹å€¼
  161   1        TH0 = 0xA2;       //è®¾ç½®å®šæ—¶åˆå§‹å€¼
  162   1        TF0 = 0;        //æ¸…é™¤TF0æ ‡å¿—
  163   1        TR0 = 1;        //å®šæ—¶å™¨0
  164   1        ET0 = 1;        //ä½¿èƒ½å®šæ—¶å™¨0ä¸­æ–­
  165   1          EA = 1;           //ä½¿èƒ½æ€»ä¸­æ–­
  166   1      }
  167          
  168          // å»¶æ—¶å‡½æ•°ï¼Œæœ¬å®ä¾‹ä¸­æœªä½¿ç”¨
  169          // void delay_ms(unsigned char ms)
  170          // {
  171          //      unsigned int i;
  172          //      do{
  173          //           i = MAIN_Fosc / 6000;
  174          //           while(--i);
  175          //      }while(--ms);
  176          // }
  177          
  178          
  179          void main(void)
  180          {
  181   1          P4M0 = 0xff; P4M1 = 0x00;           //é…ç½®P4ä¸ºè¾“å‡ºæ¨¡å¼
  182   1          P2M0 = 0x00; P2M1 = 0x00;           //é…ç½®P2ä¸ºè¾“å…¥æ¨¡å¼
  183   1          timer0_init();
  184   1          while(1)
  185   1          {
  186   2              key1_check();
  187   2              key2_check();
  188   2              key3_check();
C251 COMPILER V5.60.0,  main                                                               26/03/24  10:39:46  PAGE 4   

  189   2              key4_check();
  190   2          }
  191   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       422     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =        28     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =        72     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
